
{% extends "_layout.html" %}
{% block title %}Create a Listing{% endblock %}
{% block body %}
<style>
    .form-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh; 
    }

    .form-group {
        margin-bottom: 10px; 
    }

    label{
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
    }

    .drop-zone{
        max-width: 200px;
        height: 100px;
        padding: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-family: sans-serif;
        font-size: 15px;
        cursor: pointer;
        color: rgb(92, 89, 85);
        border: 4px dashed lightblue;
        border-radius: 5px;
    }
    .drop-zone--over{
        border-style: solid;
    }

    .drop-zone__input{
        display: none;
    }

    .drop-zone__thumb {
        width: 100px;
        height: 100px;
        border-radius: 10px;
        overflow: hidden;
        background-color: #cccccc;
        background-size: cover;
        position: relative;
    }

    .drop-zone__thumb::after{
        content: attr(data-label);
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 5px 0;
        color: white;
        background: rgb(62, 65, 62);
        font-size: 14px;
        text-align: center;
    }

    .file-item {
        margin-bottom: 5px;
    }

    .remove-button {
        color: #fff;
        background-color: #f00;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
    }

    .remove-button:hover {
        background-color: #c00;
    }

    .logosmall {
        display: block; 
        margin: 0 auto; 
        height: auto;
        width: 400px;
    }
</style>

<div class="form-container">
<br><img src="/static/createpost.png" alt="create a post" class="logosmall"><br>

<form action="/create_post" method="POST" enctype="multipart/form-data">
    <div class="form-group">
        <label for="title">Title</label>
        <input type="text" id="title" name="title" required>
    </div>

    <div class="form-group">
        <label for="price">Price</label>
        <input type="number" id="price" name="price" required>
    </div>

    <div class="form-group">
        <label for="hashtags">Hashtags</label>
        <input type="text" id="hashtags" name="hashtags" required>
    </div>

    <div class="form-group">
        <label for="condition">Condition</label>
        <select id="condition" name="condition" required>
            <option value="new">New</option>
            <option value="like_new">Like New</option>
            <option value="good">Good</option>
            <option value="fair">Fair</option>
            <option value="poor">Poor</option>
        </select>
    </div>
    

    <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" name="description" style="width: 300px; height: 150px;" placeholder="Tell us more..." required></textarea>
    </div>

    <div class="drop-zone">
        <span class="drop-zone__prompt">Drop files or click here</span>
        <input type="file" name="myFile" class="drop-zone__input" multiple>
    </div>
    <div id="file-list" class="file-list"></div><br><br>

    <button type="submit">Submit</button><br><br><br>
</form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll(".drop-zone__input").forEach(inputElement => {
            const dropZoneElement = inputElement.closest(".drop-zone");
            const fileListContainer = document.getElementById("file-list");
            let uploadedFiles = []; // Array to store uploaded files

            // Function to update the file list displayed to the user
            function updateFileList(files) {
                // Clear existing file list
                fileListContainer.innerHTML = "";

                // Update file list with names of uploaded files and remove buttons
                files.forEach((file, index) => {
                    let fileItem = document.createElement("div");
                    fileItem.classList.add("file-item");

                    let fileName = document.createElement("span");
                    fileName.textContent = file.name;

                    let removeButton = document.createElement("button");
                    removeButton.textContent = "Remove";
                    removeButton.classList.add("remove-button");

                    // Add click event listener to remove button
                    removeButton.addEventListener("click", () => {
                        // Remove the file from the uploadedFiles array
                        uploadedFiles.splice(index, 1);
                        // Update file list
                        updateFileList(uploadedFiles);
                    });

                    fileItem.appendChild(fileName);
                    fileItem.appendChild(removeButton);

                    // If the file is an image, create a preview
                    if (file.type.startsWith("image/")) {
                        let filePreview = document.createElement("img");
                        filePreview.classList.add("drop-zone__thumb");
                        filePreview.src = URL.createObjectURL(file);
                        fileItem.appendChild(filePreview);
                    }

                    fileListContainer.appendChild(fileItem);
                });

                // Update the drop zone prompt visibility
                if (files.length === 0) {
                    dropZoneElement.querySelector('.drop-zone__prompt').style.display = 'block';
                }
            }

            // Handle file input change event
            inputElement.addEventListener("change", e => {
                if (inputElement.files.length) {
                    // Add newly uploaded files to the uploadedFiles array
                    uploadedFiles.push(...inputElement.files);
                    updateFileList(uploadedFiles);
                }
            });

            // Handle click event to open file dialog
            dropZoneElement.addEventListener("click", e => {
                inputElement.click();
            });

            // Handle file drop event
            dropZoneElement.addEventListener("drop", e => {
                e.preventDefault();
                dropZoneElement.classList.remove("drop-zone--over");

                if (e.dataTransfer.files.length) {
                    // Add dropped files to the uploadedFiles array
                    uploadedFiles.push(...e.dataTransfer.files);
                    updateFileList(uploadedFiles);
                }
            });

            // Handle drag over event
            dropZoneElement.addEventListener("dragover", e => {
                e.preventDefault();
                dropZoneElement.classList.add("drop-zone--over");
            });

            // Handle drag leave and drag end events
            ["dragleave", "dragend"].forEach(type => {
                dropZoneElement.addEventListener(type, e => {
                    dropZoneElement.classList.remove("drop-zone--over");
                });
            });
        });
    });
</script>
{% endblock %}

